@if (loading) {
<div>
    Loading
</div>
}

<div class="sau-table">

    <!----------------------------------- Table mobile ----------------------------------->
    <div class="sau-table-mobile">
        <!-- Mobile header -->
        <div class="sau-table-mobile-header">
            <h3 class="sau-table-mobile-title">Lista de elementos</h3>
            <div class="sau-table-mobile-divider"></div>
        </div>

        <table class="sau-table-mobile-table">
            <tbody>
                @for (item of items; track $index) {
                <tr class="sau-table-mobile-row">
                    <td>
                        <table class="sau-table-width-full">
                            <tbody>
                                @for (header of headers; track $index) {
                                <tr [class]="$index%2==0?'sau-table-mobile-row-even':''">

                                    <th scope="col" class="sau-table-mobile-header-cell">
                                        {{header.name}}
                                    </th>
                                    <td class="sau-table-mobile-data-cell">

                                        @if(header.type == 'table' && !isArray(header.key)){

                                        <!-- CSS-only toggle button -->
                                        <input type="checkbox" [id]="'toggle-table-' + $index"
                                            class="sau-table-toggle-input">
                                        <label [for]="'toggle-table-' + $index" class="sau-table-toggle-label">
                                            <span class="sau-icon sau-icon-chevron-down">
                                                <sau-chevron-down-icon></sau-chevron-down-icon>
                                            </span>
                                            <span class="sau-table-toggle-text">
                                                <span class="sau-table-toggle-show">Mostrar</span>
                                                <span class="sau-table-toggle-hide">Ocultar</span>
                                            </span>
                                        </label>

                                        <!-- Content that toggles -->
                                        <div class="sau-table-toggle-content">
                                            <sau-table [headers]="header.headers"
                                                [items]="getValue(item, header.key)"></sau-table>
                                        </div>

                                        }@else{
                                        <ng-container [ngTemplateOutlet]="DataTemplate"
                                            [ngTemplateOutletContext]="{item:item, header:header}"></ng-container>

                                        }

                                    </td>

                                </tr>
                                }

                                @if(this.url){
                                <tr class="sau-table-mobile-actions-row">
                                    <td colspan="2">
                                        <div class="sau-table-mobile-actions-container">
                                            @if(editButtonTemplate){
                                            <ng-container
                                                *ngTemplateOutlet="editButtonTemplate; context: { $implicit: item }"></ng-container>

                                            } @else if(hasEditSubscription){
                                            <button class="sau-table-edit-button" (click)="clickEditButton(item.id)">
                                                <span class="sau-icon sau-icon-pen">
                                                    <sau-pen-icon></sau-pen-icon>
                                                </span>
                                                Editar
                                            </button>
                                            }

                                            @if(deleteButtonTemplate){
                                            <ng-container
                                                *ngTemplateOutlet="deleteButtonTemplate; context: { $implicit: item }"></ng-container>

                                            } @else if(hasDeleteSubscription){
                                            <button class="sau-table-delete-button"
                                                (click)="clickDeleteButton(item.id)">
                                                <span class="sau-icon sau-icon-trash">
                                                    <sau-trash-icon></sau-trash-icon>
                                                </span>
                                                Eliminar
                                            </button>
                                            }

                                        </div>
                                    </td>
                                </tr>
                                }

                            </tbody>
                        </table>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    <!--------------------------------- Table mobile end --------------------------------->

    <!----------------------------------- Table desktop ----------------------------------->
    <table class="sau-table-desktop">
        <thead class="sau-table-desktop-header">
            <tr>
                @for (header of headers; track $index) {
                <th scope="col" class="sau-table-desktop-header-cell">
                    {{header.name}}
                </th>
                }

                @if(this.url){
                <th scope="col" class="sau-table-desktop-header-cell">
                    Opciones
                </th>
                }
            </tr>
        </thead>
        <tbody>
            @for (item of items; track $index) {
            <tr [class]="'sau-table-desktop-row ' + ($index%2==0?'sau-table-desktop-row-even':'')">

                @for (header of headers; track $index) {
                <td class="sau-table-desktop-cell">

                    @if(header.type == 'table'){

                    @if(!isArray(header.key)){
                    <sau-table [headers]="header.headers" [items]="getValue(item, header.key)"></sau-table>
                    }

                    }@else{
                    <ng-container [ngTemplateOutlet]="DataTemplate"
                        [ngTemplateOutletContext]="{item:item, header:header}"></ng-container>
                    }

                </td>
                }

                @if(this.url){
                <td class="sau-table-desktop-actions-cell">
                    <div class="sau-table-desktop-actions-container">

                        @if(editButtonTemplate){
                        <ng-container
                            *ngTemplateOutlet="editButtonTemplate; context: { $implicit: item }"></ng-container>

                        } @else if(hasEditSubscription){
                        <button class="sau-table-desktop-edit-button" (click)="clickEditButton(item.id)" title="Editar">
                            <span class="sau-icon sau-icon-pen">
                                <sau-pen-icon></sau-pen-icon>
                            </span>
                        </button>
                        }

                        @if(deleteButtonTemplate){
                        <ng-container
                            *ngTemplateOutlet="deleteButtonTemplate; context: { $implicit: item }"></ng-container>

                        } @else if(hasDeleteSubscription){
                        <button class="sau-table-desktop-delete-button" (click)="clickDeleteButton(item.id)"
                            title="Eliminar">
                            <span class="sau-icon sau-icon-trash">
                                <sau-trash-icon></sau-trash-icon>
                            </span>
                        </button>
                        }

                    </div>
                </td>
                }

            </tr>
            }
        </tbody>
    </table>
    <!--------------------------------- table desktop end --------------------------------->

    @if (items.length == 0) {
    <div class="sau-table-empty">
        <div class="sau-table-empty-icon">
            <span class="sau-icon sau-icon-inbox">
                <sau-inbox-icon></sau-inbox-icon>
            </span>
        </div>
        <p class="sau-table-empty-title">No hay elementos</p>
        <p class="sau-table-empty-subtitle">Los elementos aparecerán aquí cuando estén disponibles</p>
    </div>

    } @else if(total.length > 1) {

    <!----------------------------------- Pagination ----------------------------------->
    <div class="sau-table-pagination">

        <!-- Números de página -->
        <div class="sau-table-pagination-number-buttons">
            @for (item of visiblePages; track $index) {
            <button (click)="changePage(item)"
                [class]="'sau-table-pagination-number-button ' + (item == page ? 'sau-table-pagination-number-button-active' : 'sau-table-pagination-number-button-inactive')"
                type="button">
                {{item}}
            </button>
            }
        </div>

        <!-- Botones de navegación izquierda -->
        <div class="sau-table-pagination-nav-left">
            <!-- Botón ir al inicio -->
            <button type="button" (click)="goToFirstPage()"
                [class]="'sau-table-pagination-nav-button-wide ' + (page == 1?'sau-table-pagination-nav-button-disabled':'sau-table-pagination-nav-button-enabled')"
                title="Ir al inicio">
                <sau-chevron-double-left-icon></sau-chevron-double-left-icon>
            </button>

            <!-- Botón página anterior -->
            <button type="button" (click)="changePage(page-1)"
                [class]="'sau-table-pagination-nav-button ' + (page == 1?'sau-table-pagination-nav-button-disabled':'sau-table-pagination-nav-button-enabled')"
                title="Página anterior">
                <sau-chevron-left-icon></sau-chevron-left-icon>
            </button>
        </div>

        <!-- Botones de navegación derecha -->
        <div class="sau-table-pagination-nav-right">
            <!-- Botón página siguiente -->
            <button type="button" (click)="changePage(page+1)"
                [class]="'sau-table-pagination-nav-button ' + (page == total[total.length-1]?'sau-table-pagination-nav-button-disabled':'sau-table-pagination-nav-button-enabled')"
                title="Página siguiente">
                <sau-chevron-right-icon></sau-chevron-right-icon>
            </button>

            <!-- Botón ir al final -->
            <button type="button" (click)="goToLastPage()"
                [class]="'sau-table-pagination-nav-button-wide ' + (page == total[total.length-1]?'sau-table-pagination-nav-button-disabled':'sau-table-pagination-nav-button-enabled')"
                title="Ir al final">
                <sau-chevron-double-right-icon></sau-chevron-double-right-icon>
            </button>
        </div>
    </div>
    <!--------------------------------- pagination end --------------------------------->
    }

</div>

<!----------------------------------- Data template ----------------------------------->
<ng-template #DataTemplate let-item="item" let-header="header">

    <section class="sau-table-data-section">

        @if(header.name == 'NOMBRE' && item.role == 'ROLE_ADMIN') {
        <div class="sau-table-admin-crown">
            <span class="sau-icon sau-icon-crown">
                <sau-crown-icon></sau-crown-icon>
            </span>
        </div>
        }

        <span>
            @if (header.innerHtml) {
            <span [innerHTML]="getValue(item, header.key)"></span>
            } @else {
            <ng-container [ngTemplateOutlet]="DataTypeTemplate"
                [ngTemplateOutletContext]="{item:item, header:header, value:header.key}"></ng-container>
            }

            @if(header.subKey){
            <span class="sau-table-subkey">
                (
                <ng-container [ngTemplateOutlet]="DataTypeTemplate"
                    [ngTemplateOutletContext]="{item:item, header:header, value:header.subKey}"></ng-container>
                )
            </span>
            }
        </span>

    </section>

</ng-template>
<!--------------------------------- Data template end --------------------------------->

<!----------------------------------- Data Type template ----------------------------------->
<ng-template #DataTypeTemplate let-item="item" let-header="header" let-value="value">

    <section class="sau-table-data-type-section">
        @switch (header.type) {

        @case ('boolean') {
        @if(getValue(item, value)){
        <div class="sau-table-boolean-true">
            <span class="sau-icon sau-icon-check">
                <sau-check-icon></sau-check-icon>
            </span>
        </div>
        } @else {
        <div class="sau-table-boolean-false">
            <span class="sau-icon sau-icon-xmark">
                <sau-xmark-icon></sau-xmark-icon>
            </span>
        </div>
        }
        }

        @case ('currency'){
        <!-- {{formatEuro(getValue(item, value))}} -->
        }

        @case ('dateTime') {
        <span class="sau-table-datetime">
            {{getValue(item, value) | date: 'dd/MM/yyyy HH:mm'}}
        </span>
        }

        @case ('color'){
        <span class="sau-table-color-indicator" [style.background-color]="getValue(item, value)"></span>
        }

        @case ('link'){
        @let link = getLink(header.url, item, value);

        @if(link.isExternal){
        <a [href]="link.url" class="sau-table-link">
            {{header.linkName}}
        </a>
        }@else{
        <a [routerLink]="link.url" class="sau-table-link" target="_blank">
            {{header.linkName}}
        </a>
        }

        }

        @case ('image'){
        @let link = getLink(header.url, item, value);

        <img [src]="link.url" [alt]="getValue(item, value)" loading="lazy" class="sau-table-image">
        }

        @case ('login'){
        @if(item.active){
        <span class="sau-table-login-container">

            @if(item.email_verified_at){
            <div [title]="item.email" class="sau-table-login-email-verified">
                <span class="sau-icon sau-icon-envelope">
                    <sau-envelope-icon></sau-envelope-icon>
                </span>
            </div>
            }

            @if(item.google_id){
            <div [title]="item.google_id" class="sau-table-login-google">
                <span class="sau-icon sau-icon-google">
                    <sau-google-icon></sau-google-icon>
                </span>
            </div>
            }

        </span>
        } @else {
        <div class="sau-table-login-inactive">
            <span class="sau-icon sau-icon-xmark">
                <sau-xmark-icon></sau-xmark-icon>
            </span>
        </div>
        }
        }

        @default {
        {{getValue(item, value)}}
        }
        }
    </section>

</ng-template>
<!--------------------------------- Data Type template end --------------------------------->